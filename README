This code is based in https://github.com/enthought/Python-2.7.3/blob/master/Demo/sockets/throughput.py
